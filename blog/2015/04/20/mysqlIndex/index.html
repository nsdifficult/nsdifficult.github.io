
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>MySql索引的使用笔记 - RONGYI.WORK</title>
	<meta name="author" content="易荣义">

	
	<meta name="description" content="什么是数据库索引？ 数据库索引，是数据库管理系统中一个排序的数据结构，以协助快速查询、更新数据库表中数据。 MySql中索引使用的数据结构？ BTree。MyISAM引擎使用B+Tree作为索引结构；InnoDB存储引擎也使用B+Tree作为索引结构，但两者的具体实现方式不同， &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="RONGYI.WORK" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="http://libs.useso.com/js/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">RONGYI.WORK</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">主页</a></li>
	<li><a href="/blog/archives">所有文章</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">主页</a></li>
	<li><a href="/blog/archives">所有文章</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:rongyi.work">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="https://www.google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:rongyi.work">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">MySql索引的使用笔记</h2>
	<div class="entry-content"><h2>什么是数据库索引？</h2>

<p>数据库索引，是数据库管理系统中一个排序的数据结构，以协助快速查询、更新数据库表中数据。</p>

<h2>MySql中索引使用的数据结构？</h2>

<p>BTree。MyISAM引擎使用B+Tree作为索引结构；InnoDB存储引擎也使用B+Tree作为索引结构，但两者的具体实现方式不同，具体见<a href="http://blog.codinglabs.org/articles/theory-of-mysql-index.html">MySQL索引背后的数据结构及算法原理</a></p>

<h2>什么是聚集索引和非聚集索引？</h2>

<p>数据记录本身被存于索引<!--more-->（一颗B+Tree）的叶子节点上，这种索引叫<strong>聚集索引</strong>，InnoDB使用聚集索引。反之则为<strong>非聚集索引</strong>，MyISAM使用非聚集索引，它的叶子节点的data域指向数据记录的地址，而不是存储数据记录本身；</p>

<h2>MySql支持聚集索引吗？</h2>

<p>MySQL有没有支持聚集索引，取决于采用哪种存储引擎。MySQL InnoDB一定会建立聚集索引。InnoDB的数据文件本身就是索引文件，且按主键聚集 <br/>
关于聚集索引还需注意： <br/>
1. 如果声声明了主键(primary key)，则这个列会被做为聚集索引。<br/>
2. 如果没有声明主键，则会用一个唯一且不为空的索引列做为主键，成为此表的聚集索引。
3. 上面二个条件都不满足，InnoDB会自己产生一个虚拟的字段作为聚集索引，这个字段长度为6个字节，类型为长整形。</p>

<h2>MySql有几种索引？</h2>

<p>普通索引；主键索引；唯一索引；联合索引；全文索引。</p>

<h2>索引特性：</h2>

<ol>
<li>B+树的性质决定：索引的字段（数据项）长度越小，树的高度越低，查询次数越少，即磁盘IO次数越少（所以尽量使用字段类型较小的字段作为索引，如尽量使用int型而不是long型字段）。</li>
<li>索引的最左匹配特性</li>
</ol>


<h2>建索引的几个原则（转自<a href="http://tech.meituan.com/mysql-index.html">MySQL索引原理及慢查询优化</a>）</h2>

<ol>
<li>最左前缀匹配原则，非常重要的原则，mysql会一直向右匹配直到遇到范围查询(>、&lt;、between、like)就停止匹配，比如a = 1 and b = 2 and c > 3 and d = 4 如果建立(a,b,c,d)顺序的索引，d是用不到索引的，如果建立(a,b,d,c)的索引则都可以用到，a,b,d的顺序可以任意调整。</li>
<li>=和in可以乱序，比如a = 1 and b = 2 and c = 3 建立(a,b,c)索引可以任意顺序，mysql的查询优化器会帮你优化成索引可以识别的形式。</li>
<li>尽量选择区分度高的列作为索引,区分度（Selectivity）的公式是count(distinct col)/count(*)，表示字段不重复的比例，比例越大我们扫描的记录数越少，唯一键的区分度是1，而一些状态、性别字段可能在大数据面前区分度就是0，那可能有人会问，这个比例有什么经验值吗？使用场景不同，这个值也很难确定，一般需要join的字段我们都要求是0.1以上，即平均1条扫描10条记录。</li>
<li>索引列不能参与计算，保持列“干净”，比如from_unixtime(create_time) = ’2014-05-29’就不能使用到索引，原因很简单，b+树中存的都是数据表中的字段值，但进行检索时，需要把所有元素都应用函数才能比较，显然成本太大。所以语句应该写成create_time = unix_timestamp(’2014-05-29’);</li>
<li>尽量的扩展索引，不要新建索引。比如表中已经有a的索引，现在要加(a,b)的索引，那么只需要修改原来的索引即可。</li>
<li>尽量不使用like，非要使用注意like &lsquo;%XXX'不会使用索引，而like 'XXX%'可以。</li>
<li>如果直接使用字段建索引太长，可以考虑建立前缀索引（即不直接使用整个字段，而是根据上文提到的Selectivity来使用字段的前缀）。如</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ALTER TABLE employees.employees ADD INDEX `first_name_last_name4` (first_name, last_name(4));</span></code></pre></td></tr></table></div></figure>


<h2>sql查询语句在使用索引方面的注意事项</h2>

<ol>
<li>不要在索引列上进行运算（如+，-，*，/，! 等）；</li>
<li>不要在索引列上运用函数（如avg等）；</li>
<li>不要在like语句中将百分号在前（如"%&ndash;&ldquo;）；</li>
<li>字符型字段为数字时在where条件里不添加引号；</li>
<li>当where条件中有索引字段，需要排序时尽量对索引字段进行排序；</li>
</ol>


<h2>参考文章</h2>

<ol>
<li><a href="http://tech.meituan.com/mysql-index.html">MySQL索引原理及慢查询优化</a></li>
<li><a href="http://blog.codinglabs.org/articles/theory-of-mysql-index.html">MySQL索引背后的数据结构及算法原理</a></li>
<li><a href="http://www.zhdba.com/mysqlops/2011/11/24/understanding_index/">由浅入深理解索引的实现(1)</a>
<a href="http://blog.sina.com.cn/s/blog_6e322ce7010101i7.html">MYSQL索引失效的各种情形总结</a></li>
</ol>

</div>


<div class="meta">
	<div class="date">




Apr 20th, 2015</div>
	<div class="tags">

</div>
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		
		
		
	</div>
	
</div>



｛% if site.duoshuo_short_name and site.duoshuo_comments == true and page.comments == true %｝
  <section>
    <h1>评论</h1>
    <div id="comments" aria-live="polite">｛% include post/duoshuo.html %｝</div>
  </section>
｛% endif %｝</div>
	<footer id="footer" class="inner">Copyright &copy; 2015

    易荣义

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>